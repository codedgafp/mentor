YUI.add("moodle-atto_video-button",function(t,e){var o={INPUTURL:"atto_video_urlentry",INPUTSUBMIT:"atto_video_urlentrysubmit"},i={INPUTURL:"."+o.INPUTURL};t.namespace("M.atto_video").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_allowedDomains:null,initializer:function(){this._allowedDomains=this.get("alloweddomains"),this.addButton({icon:"icon",iconComponent:"atto_video",callback:this._displayDialogue,tags:"img",tagMatchRequiresAll:!1})},_displayDialogue:function(){if(this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection){var t=M.util.get_string("pluginname","atto_video");""!=this._allowedDomains&&(t+='<a class="btn btn-link p-0"  role="button" data-container="body" data-toggle="popover" data-placement="right" data-content="<div>'+M.util.get_string("allowed_domain","atto_video")+" : "+this._allowedDomains+'</div>" data-html="true" tabindex="0" data-trigger="focus"><i class="icon fa fa-question-circle text-info fa-fw"></i></a>');var e=this.getDialogue({headerContent:t,width:"auto",focusAfterHide:!0,focusOnShowSelector:i.INPUTURL});e.get("boundingBox").setStyle("maxWidth","90%"),e.set("bodyContent",this._getDialogueContent()).show()}},_getDialogueContent:function(){var e=t.Handlebars.compile('<form class="atto_form"><div class="mb-1"><input class="form-control fullwidth {{CSS.INPUTURL}}" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div><div id="attovideo-error"></div><br/><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "save" component}}</button></div></form>'),i=t.Node.create(e({elementid:this.get("host").get("elementid"),CSS:o,component:"atto_video"}));return this._form=i,this._form.one("."+o.INPUTSUBMIT).on("click",this._setVideo,this),i},_setVideo:function(e){var i=this._form,a=i.one("."+o.INPUTURL).get("value"),n=this.get("host");if(e.preventDefault(),""!=a){if(""!=this._allowedDomains){for(var l=!1,r=0;r<this._allowedDomains.length;r++){var s=this._allowedDomains[r];if(a.startsWith(s)){l=!0;break}}if(!l)return void i.one("#attovideo-error").setHTML(M.util.get_string("errorallowedurl","atto_video"))}-1==(a=(a=a.replaceAll("/watch/","/embed/")).replaceAll("/w/","/videos/embed/")).indexOf("?")?a+="?title=0&warningTitle=0&peertubeLink=0":a+="&title=0&warningTitle=0&peertubeLink=0";var d=t.Handlebars.compile('<div class="mentor-video embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" sandbox="allow-same-origin allow-scripts allow-popups" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>')({url:a});n.focus(),n.setSelection(this._currentSelection),this.get("host").insertContentAtFocusPoint(d),this.markUpdated(),this.getDialogue({focusAfterHide:null}).hide()}else i.one("#attovideo-error").setHTML(M.util.get_string("erroremptyurl","atto_video"))}},{ATTRS:{alloweddomains:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});